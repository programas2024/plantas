<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PlantID - Identificador de Plantas üåø</title>
  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <!-- Teachable Machine (imagen) -->
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary: #5697bd;
      --primary-light: #48cae4;
      --primary-dark: #1d7875;
      --secondary: #e9c46a;
      --secondary-light: #f4e8c9;
      --accent: #e76f51;
      --accent-light: #f8d7ce;
      --background: #f8f9fa;
      --card-background: #ffffff;
      --text-primary: #264653;
      --text-secondary: #6c757d;
      --text-light: #a0aec0;
      --border: #e2e8f0;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 10px 30px rgba(0, 0, 0, 0.12);
      --radius: 16px;
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      
    }
    
    .container {
      max-width: 1500px;
      margin: 0 auto;
    }
    
    header {
      background: linear-gradient(to right, var(--primary), var(--primary-light));
      color: white;
      padding: 15px 0;
      box-shadow: var(--shadow);
      
      margin-bottom: 30px;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.8rem;
      font-weight: 600;
    }
    
    .nav-buttons {
      display: flex;
      gap: 15px;
    }
    
    .nav-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    
    .hero {
      text-align: center;
      padding: 40px 20px;
      background: var(--card-background);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 40px;
    }
    
    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: var(--primary-dark);
    }
    
    .hero p {
      font-size: 1.2rem;
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto 30px;
    }
    
    .main-content {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
      margin-bottom: 40px;
    }
    
    .upload-section {
      flex: 1;
      min-width: 300px;
      max-width: 500px;
    }
    
    .info-section {
      flex: 1;
      min-width: 300px;
      max-width: 600px;
    }
    
    .card {
      background: var(--card-background);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 25px;
      transition: var(--transition);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .card-title {
      color: var(--primary);
      font-size: 1.4rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .upload-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .upload-option {
      background: var(--secondary-light);
      border: 2px dashed var(--secondary);
      border-radius: 12px;
      padding: 25px 15px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .upload-option:hover {
      background: var(--secondary-light);
      border-color: var(--primary);
      transform: translateY(-3px);
    }
    
    .upload-icon {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 15px;
    }
    
    .btn {
      display: inline-block;
      background: var(--primary);
      color: white;
      padding: 14px 25px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: var(--transition);
      text-align: center;
      width: 100%;
      margin-top: 10px;
    }
    
    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    
    .btn-accent {
      background: var(--accent);
    }
    
    .btn-accent:hover {
      background: #d45a3c;
    }
    
    #preview-container {
      position: relative;
      margin: 20px 0;
      display: none;
      text-align: center;
    }
    
    #preview {
      max-width: 100%;
      max-height: 400px;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }
    
    .camera-container {
      display: none;
      margin: 20px 0;
      text-align: center;
    }
    
    #video {
      width: 100%;
      max-height: 400px;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }
    
    .camera-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }
    
    .camera-btn {
      padding: 10px 20px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .instructions {
      background: var(--secondary-light);
      padding: 20px;
      border-radius: var(--radius);
      margin-top: 20px;
    }
    
    .instructions h3 {
      color: var(--primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .instructions ol {
      padding-left: 20px;
      text-align: left;
    }
    
    .instructions li {
      margin-bottom: 10px;
      line-height: 1.5;
    }
    
    .result-placeholder {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-light);
    }
    
    .result-placeholder i {
      font-size: 4rem;
      margin-bottom: 20px;
      color: var(--border);
    }
    
    .plant-info {
      display: none;
    }
    
    .info-item {
      margin-bottom: 15px;
      display: flex;
      align-items: flex-start;
    }
    
    .info-icon {
      color: var(--primary);
      margin-right: 12px;
      font-size: 1.2rem;
      margin-top: 3px;
    }
    
    .info-content {
      flex: 1;
    }
    
    .info-label {
      font-weight: 600;
      color: var(--primary-dark);
      display: block;
      margin-bottom: 5px;
    }
    
    footer {
      text-align: center;
      padding: 30px;
      color: var(--text-secondary);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    .loading-spinner {
      border: 4px solid var(--border);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    .permission-help {
      background: var(--accent-light);
      border-left: 4px solid var(--accent);
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
      text-align: left;
      display: none;
    }
    
    .permission-help h4 {
      color: var(--accent);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .camera-status {
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .upload-options {
        grid-template-columns: 1fr;
      }
      
      .main-content {
        flex-direction: column;
      }
      
      .header-content {
        flex-direction: column;
        gap: 15px;
      }
      
      .nav-buttons {
        width: 100%;
        justify-content: center;
      }
      
      .hero h1 {
        font-size: 2rem;
      }
      
      .hero p {
        font-size: 1rem;
      }
      
      .camera-controls {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>

</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div class="logo">
          <i class="fas fa-leaf"></i>
          <span>Butify</span>
        </div>
        <div class="nav-buttons">
          <button class="nav-btn" id="aboutBtn">
            <i class="fas fa-info-circle"></i> Acerca de
          </button>
          <button class="nav-btn" id="safireBtn">
            <i class="fas fa-star"></i> Safire
          </button>
        </div>
      </div>
    </header>
    
    <section class="hero">
      <h1>Identificador de Plantas Medicinales</h1>
      <p>Descubre informaci√≥n sobre plantas medicinales y sus propiedades con solo una foto</p>
    </section>
    
    <div class="main-content">
      <div class="upload-section">
        <div class="card">
          <h2 class="card-title"><i class="fas fa-camera"></i> Identificar planta</h2>
          
          <div class="upload-options">
            <div class="upload-option" id="uploadGallery">
              <div class="upload-icon">
                <i class="fas fa-folder-open"></i>
              </div>
              <p>Desde la galer√≠a</p>
            </div>
            
            <div class="upload-option" id="openCamera">
              <div class="upload-icon">
                <i class="fas fa-camera"></i>
              </div>
              <p>Tomar foto</p>
            </div>
          </div>
          
          <input type="file" id="fileInput" accept="image/*" hidden>
          
          <div class="camera-container" id="cameraContainer">
            <video id="video" autoplay playsinline></video>
            <div class="camera-status" id="cameraStatus">
              <i class="fas fa-camera"></i>
              <span id="cameraType">C√°mara trasera activada</span>
            </div>
            <div class="camera-controls">
              <button class="camera-btn btn-accent" id="captureBtn">
                <i class="fas fa-camera"></i> Capturar
              </button>
              <button class="camera-btn btn-outline" id="switchCameraBtn">
                <i class="fas fa-sync-alt"></i> Cambiar c√°mara
              </button>
              <button class="camera-btn btn-outline" id="closeCameraBtn">
                <i class="fas fa-times"></i> Cerrar
              </button>
            </div>
          </div>
          
          <div class="permission-help" id="permissionHelp">
            <h4><i class="fas fa-exclamation-triangle"></i> Permisos de c√°mara</h4>
            <p>Para usar la c√°mara, necesitas permitir el acceso en tu navegador. Si no ves la solicitud de permisos:</p>
            <ol>
              <li>Haz clic en el icono de candado o c√°mara en la barra de direcciones</li>
              <li>Configura los permisos de c√°mara para "Permitir"</li>
              <li>Recarga la p√°gina e intenta de nuevo</li>
            </ol>
            <p style="margin-top: 10px;"><strong>Nota:</strong> Algunos navegadores pueden requerir HTTPS para acceder a la c√°mara.</p>
          </div>
          
          <div id="preview-container">
            <img id="preview">
            <div style="margin-top: 20px;">
              <button class="btn" id="analyzeBtn">
                <i class="fas fa-search"></i> Analizar planta
              </button>
              <button class="btn btn-outline" id="cancelBtn">
                <i class="fas fa-times"></i> Cancelar
              </button>
            </div>
          </div>
          
          <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Analizando imagen...</p>
          </div>
        </div>
        
        <div class="card">
          <h2 class="card-title"><i class="fas fa-lightbulb"></i> Consejos para mejores resultados</h2>
          <ul style="padding-left: 20px;">
            <li>Aseg√∫rate de que la planta est√© bien iluminada</li>
            <li>Enfoca claramente las hojas o flores</li>
            <li>Toma la foto sobre un fondo neutro si es posible</li>
            <li>Ac√©rcate lo suficiente para ver los detalles</li>
            <li>Toma fotos desde diferentes √°ngulos para mejor identificaci√≥n</li>
          </ul>
        </div>
      </div>
      
      <div class="info-section">
        <div class="card">
          <h2 class="card-title"><i class="fas fa-info-circle"></i> Informaci√≥n de la planta</h2>
          
          <div class="result-placeholder" id="resultPlaceholder">
            <i class="fas fa-seedling"></i>
            <p>La informaci√≥n de la planta identificada aparecer√° aqu√≠</p>
          </div>
          
          <div class="plant-info" id="plantInfo">
            <!-- La informaci√≥n de la planta se insertar√° aqu√≠ -->
          </div>
        </div>
        
        <div class="card">
          <h2 class="card-title"><i class="fas fa-book-medical"></i> Plantas identificables</h2>
          <div class="info-item">
            <div class="info-icon">
              <i class="fas fa-leaf"></i>
            </div>
            <div class="info-content">
              <span class="info-label">Sauco</span>
              <span>Sambucus nigra - Usado para resfriados y afecciones de la piel</span>
            </div>
          </div>
          
          <div class="info-item">
            <div class="info-icon">
              <i class="fas fa-leaf"></i>
            </div>
            <div class="info-content">
              <span class="info-label">Manzanilla</span>
              <span>Matricaria chamomilla - Relajante y ayuda digestiva</span>
            </div>
          </div>
          
          <div class="info-item">
            <div class="info-icon">
              <i class="fas fa-leaf"></i>
            </div>
            <div class="info-content">
              <span class="info-label">S√°bila</span>
              <span>Aloe vera - Cicatrizante e hidratante natural</span>
            </div>
          </div>
          
          <div class="info-item">
            <div class="info-icon">
              <i class="fas fa-leaf"></i>
            </div>
            <div class="info-content">
              <span class="info-label">Menta</span>
              <span>Mentha spp. - Digestiva y refrescante</span>
            </div>
          </div>
          
          <div class="info-item">
            <div class="info-icon">
              <i class="fas fa-leaf"></i>
            </div>
            <div class="info-content">
              <span class="info-label">Romero</span>
              <span>Rosmarinus officinalis - Estimulante circulatorio y memoria</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="instructions">
      <h3><i class="fas fa-question-circle"></i> ¬øC√≥mo funciona?</h3>
      <ol>
        <li><strong>Toma una foto</strong> de la planta con la c√°mara de tu dispositivo o <strong>sube una imagen</strong> desde tu galer√≠a</li>
        <li>Nuestro sistema <strong>analizar√° la imagen</strong> usando inteligencia artificial</li>
        <li>Obtendr√°s <strong>informaci√≥n detallada</strong> sobre la planta identificada</li>
        <li>Descubre sus <strong>propiedades medicinales</strong> y <strong>usos tradicionales</strong></li>
      </ol>
    </div>
  </div>
  
  <footer>
    <div class="container">
      <p>PlantID - Identificador de Plantas Medicinales ¬© 2023</p>
      <p>Hecho con <i class="fas fa-heart" style="color: #e91e63;"></i> para amantes de la naturaleza</p>
    </div>
  </footer>

  <script>
    // Elementos DOM
    const fileInput = document.getElementById('fileInput');
    const uploadGallery = document.getElementById('uploadGallery');
    const openCamera = document.getElementById('openCamera');
    const cameraContainer = document.getElementById('cameraContainer');
    const video = document.getElementById('video');
    const captureBtn = document.getElementById('captureBtn');
    const switchCameraBtn = document.getElementById('switchCameraBtn');
    const closeCameraBtn = document.getElementById('closeCameraBtn');
    const previewContainer = document.getElementById('preview-container');
    const preview = document.getElementById('preview');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const loading = document.getElementById('loading');
    const resultPlaceholder = document.getElementById('resultPlaceholder');
    const plantInfo = document.getElementById('plantInfo');
    const aboutBtn = document.getElementById('aboutBtn');
    const safireBtn = document.getElementById('safireBtn');
    const permissionHelp = document.getElementById('permissionHelp');
    const cameraStatus = document.getElementById('cameraStatus');
    const cameraType = document.getElementById('cameraType');

    let model;
    let stream = null;
    let currentFacingMode = 'environment'; // 'environment' para c√°mara trasera, 'user' para frontal
    let availableCameras = [];
    let currentCameraIndex = 0;

    // üìö Base de datos de plantas
    const plantasDB = {
      "sauco": {
        nombre: "Sauco",
        cientifico: "Sambucus nigra",
        origen: "Europa y Am√©rica del Norte",
        usos: "Infusiones para resfriados, ung√ºentos para la piel",
        observacion: "T√≥xica en exceso, usar con precauci√≥n",
        propiedades: "Antiviral, antiinflamatorio, diafor√©tico"
      },
      "manzanilla": {
        nombre: "Manzanilla",
        cientifico: "Matricaria chamomilla",
        origen: "Europa y Asia",
        usos: "Relajante, ayuda digestiva, calmante natural",
        observacion: "Segura en infusi√≥n, no abusar en embarazo",
        propiedades: "Calmante, antiespasm√≥dica, antiinflamatoria"
      },
      "sabina": {
        nombre: "S√°bila (Aloe vera)",
        cientifico: "Aloe vera",
        origen: "√Åfrica del Norte",
        usos: "Gel cicatrizante, hidrataci√≥n de piel, quemaduras",
        observacion: "No ingerir en exceso, puede ser laxante fuerte",
        propiedades: "Cicatrizante, hidratante, antiinflamatorio"
      },
      "menta": {
        nombre: "Menta",
        cientifico: "Mentha spp.",
        origen: "Europa, Asia and √Åfrica",
        usos: "Infusiones digestivas, ambientador natural",
        observacion: "Evitar en ni√±os peque√±os y embarazo",
        propiedades: "Digestiva, antis√©ptica, refrescante"
      },
      "romero": {
        nombre: "Romero",
        cientifico: "Rosmarinus officinalis",
        origen: "Regi√≥n mediterr√°nea",
        usos: "Estimulante circulatorio, mejora la memoria",
        observacion: "Evitar en casos de hipertensi√≥n",
        propiedades: "Estimulante, antioxidante, antis√©ptico"
      }
    };

    // üöÄ Cargar el modelo entrenado
    async function loadModel() {
      try {
        // Simulamos la carga del modelo con un retraso
        await new Promise(resolve => setTimeout(resolve, 1500));
        console.log("‚úÖ Modelo cargado (simulado)");
      } catch (error) {
        console.error("Error cargando el modelo:", error);
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'No se pudo cargar el modelo de identificaci√≥n. Por favor, recarga la p√°gina.'
        });
      }
    }

    // Inicializar la aplicaci√≥n
    function init() {
      loadModel();
      setupEventListeners();
      checkCameraSupport();
    }
    
    // Verificar soporte de c√°mara
    function checkCameraSupport() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        Swal.fire({
          icon: 'warning',
          title: 'Navegador no compatible',
          text: 'Tu navegador no soporta el acceso a la c√°mara. Por favor, actualiza tu navegador o usa uno m√°s moderno.',
        });
        openCamera.style.display = 'none';
      }
    }
    
    // Configurar event listeners
    function setupEventListeners() {
      // Subir desde galer√≠a
      uploadGallery.addEventListener('click', () => {
        fileInput.click();
      });
      
      // Abrir c√°mara
      openCamera.addEventListener('click', openCameraHandler);
      
      // Capturar foto
      captureBtn.addEventListener('click', captureImage);
      
      // Cambiar c√°mara
      switchCameraBtn.addEventListener('click', switchCamera);
      
      // Cerrar c√°mara
      closeCameraBtn.addEventListener('click', closeCamera);
      
      // Manejar selecci√≥n de archivo
      fileInput.addEventListener('change', handleFileSelect);
      
      // Analizar y cancelar
      analyzeBtn.addEventListener('click', analyzeImage);
      cancelBtn.addEventListener('click', resetInterface);
      
      // Botones de informaci√≥n
      aboutBtn.addEventListener('click', () => {
        Swal.fire({
          title: 'Acerca de PlantID',
          html: `
            <p>PlantID es una aplicaci√≥n que utiliza inteligencia artificial para identificar plantas medicinales y mostrar informaci√≥n sobre sus propiedades, usos tradicionales y precauciones.</p>
            <div style="text-align: left; margin-top: 15px;">
              <h3>C√≥mo funciona</h3>
              <ol>
                <li>Toma una foto de la planta con tu c√°mara</li>
                <li>Nuestro sistema analizar√° la imagen</li>
                <li>Obtendr√°s informaci√≥n detallada sobre la planta</li>
              </ol>
            </div>
          `,
          confirmButtonText: 'Entendido'
        });
      });
      
      safireBtn.addEventListener('click', () => {
        Swal.fire({
          title: 'Safire',
          html: `
            <p>Safire es una funcionalidad premium que te permite:</p>
            <ul style="text-align: left;">
              <li>Identificar un cat√°logo m√°s amplio de plantas</li>
              <li>Obtener informaci√≥n m√°s detallada sobre usos medicinales</li>
              <li>Recibir recomendaciones personalizadas</li>
              <li>Acceder a recetas tradicionales</li>
            </ul>
            <p style="margin-top: 15px;">Pr√≥ximamente estar√° disponible para todos.</p>
          `,
          confirmButtonText: 'Entendido'
        });
      });
    }
    
    // Obtener dispositivos de c√°mara disponibles
    async function getCameraDevices() {
      try {
        const devices = await navigator.mediaDevices.enumerateDevices();
        return devices.filter(device => device.kind === 'videoinput');
      } catch (error) {
        console.error('Error enumerando dispositivos:', error);
        return [];
      }
    }
    
    // Abrir c√°mara
    async function openCameraHandler() {
      try {
        // Detener stream existente si hay uno
        if (stream) {
          stream.getTracks().forEach(track => track.stop());
        }
        
        // Obtener c√°maras disponibles
        availableCameras = await getCameraDevices();
        
        if (availableCameras.length === 0) {
          throw new Error('No se encontraron c√°maras disponibles');
        }
        
        // Configurar para usar la c√°mara trasera por defecto si est√° disponible
        const constraints = {
          video: {
            facingMode: currentFacingMode,
            width: { ideal: 1280 },
            height: { ideal: 720 }
          },
          audio: false
        };
        
        // Solicitar acceso a la c√°mara
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        
        // Mostrar video en el elemento video
        video.srcObject = stream;
        cameraContainer.style.display = 'block';
        permissionHelp.style.display = 'none';
        
        // Actualizar estado de la c√°mara
        updateCameraStatus();
        
      } catch (error) {
        console.error("Error accediendo a la c√°mara:", error);
        permissionHelp.style.display = 'block';
        
        let errorMessage = '';
        if (error.name === 'NotAllowedError') {
          errorMessage = `
            <p>Has denegado los permisos de c√°mara o el sistema ha bloqueado el acceso.</p>
            <p>Para solucionarlo:</p>
            <ol style="text-align: left;">
              <li>Haz clic en el icono de candado o c√°mara en la barra de direcciones</li>
              <li>Configura los permisos de c√°mara para "Permitir"</li>
              <li>Recarga la p√°gina e intenta de nuevo</li>
            </ol>
          `;
        } else if (error.name === 'NotFoundError' || error.name === 'OverconstrainedError') {
          errorMessage = `
            <p>No se ha encontrado una c√°mara adecuada o est√° siendo utilizada por otra aplicaci√≥n.</p>
            <p>Para solucionarlo:</p>
            <ol style="text-align: left;">
              <li>Aseg√∫rate de que tu c√°mara no est√© siendo utilizada por otra aplicaci√≥n</li>
              <li>Verifica que la c√°mara est√© conectada y funcionando correctamente</li>
              <li>Intenta con un navegador diferente si el problema persiste</li>
            </ol>
          `;
        } else {
          errorMessage = `
            <p>No se pudo acceder a la c√°mara. Por favor:</p>
            <ol style="text-align: left;">
              <li>Aseg√∫rate de permitir el acceso a la c√°mara</li>
              <li>Verifica que tu c√°mara est√© conectada y funcionando</li>
              <li>Intenta usar otro navegador si el problema persiste</li>
            </ol>
          `;
        }
        
        Swal.fire({
          icon: 'error',
          title: 'Error de c√°mara',
          html: errorMessage,
          confirmButtonText: 'Entendido'
        });
      }
    }
    
    // Actualizar estado de la c√°mara en la interfaz
    function updateCameraStatus() {
      cameraType.textContent = currentFacingMode === 'environment' 
        ? 'C√°mara trasera activada' 
        : 'C√°mara frontal activada';
    }
    
    // Cambiar entre c√°maras frontal y trasera
    async function switchCamera() {
      try {
        // Detener stream actual
        if (stream) {
          stream.getTracks().forEach(track => track.stop());
        }
        
        // Cambiar modo de c√°mara
        currentFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
        
        // Configurar nuevas restricciones
        const constraints = {
          video: {
            facingMode: currentFacingMode,
            width: { ideal: 1280 },
            height: { ideal: 720 }
          },
          audio: false
        };
        
        // Obtener nuevo stream
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        
        // Mostrar video en el elemento video
        video.srcObject = stream;
        
        // Actualizar estado de la c√°mara
        updateCameraStatus();
        
      } catch (error) {
        console.error("Error cambiando de c√°mara:", error);
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'No se pudo cambiar de c√°mara. Intenta de nuevo.'
        });
      }
    }
    
    // Cerrar c√°mara
    function closeCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
      cameraContainer.style.display = 'none';
      permissionHelp.style.display = 'none';
    }
    
    // Capturar imagen desde la c√°mara
    function captureImage() {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);
      
      // Mostrar vista previa
      showPreview(canvas.toDataURL('image/png'));
      
      // Cerrar c√°mara
      closeCamera();
    }
    
    // Manejar selecci√≥n de archivo
    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      showPreview(URL.createObjectURL(file));
    }
    
    // Mostrar vista previa
    function showPreview(src) {
      preview.src = src;
      previewContainer.style.display = 'block';
    }
    
    // Analizar imagen
    async function analyzeImage() {
      loading.style.display = 'block';
      previewContainer.style.display = 'none';
      
      try {
        // Simulamos el an√°lisis con un retraso
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Para esta demo, seleccionamos una planta aleatoria
        const plantKeys = Object.keys(plantasDB);
        const randomPlant = plantKeys[Math.floor(Math.random() * plantKeys.length)];
        
        mostrarResultado(randomPlant);
      } catch (error) {
        console.error("Error analizando imagen:", error);
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'No se pudo analizar la imagen. Por favor, intenta con otra foto.'
        });
      } finally {
        loading.style.display = 'none';
      }
    }
    
    // Mostrar resultado
    function mostrarResultado(plantaId) {
      const data = plantasDB[plantaId];
      
      if (!data) {
        Swal.fire({
          icon: 'warning',
          title: 'Planta no identificada',
          text: 'No pudimos identificar esta planta con certeza. Intenta con una foto m√°s clara.'
        });
        resetInterface();
        return;
      }
      
      // Ocultar placeholder y mostrar info
      resultPlaceholder.style.display = 'none';
      plantInfo.style.display = 'block';
      
      // Construir HTML de la informaci√≥n
      plantInfo.innerHTML = `
        <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 1.6rem;">
          <i class="fas fa-seedling" style="color: var(--primary);"></i> ${data.nombre}
        </h3>
        
        <div class="info-item">
          <div class="info-icon">
            <i class="fas fa-signature"></i>
          </div>
          <div class="info-content">
            <span class="info-label">Nombre cient√≠fico</span>
            <span>${data.cientifico}</span>
          </div>
        </div>
        
        <div class="info-item">
          <div class="info-icon">
            <i class="fas fa-globe-americas"></i>
          </div>
          <div class="info-content">
            <span class="info-label">Origen</span>
            <span>${data.origen}</span>
          </div>
        </div>
        
        <div class="info-item">
          <div class="info-icon">
            <i class="fas fa-mortar-pestle"></i>
          </div>
          <div class="info-content">
            <span class="info-label">Usos tradicionales</span>
            <span>${data.usos}</span>
          </div>
        </div>
        
        <div class="info-item">
          <div class="info-icon">
            <i class="fas fa-heart"></i>
          </div>
          <div class="info-content">
            <span class="info-label">Propiedades medicinales</span>
            <span>${data.propiedades}</span>
          </div>
        </div>
        
        <div class="info-item">
          <div class="info-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="info-content">
            <span class="info-label">Precauciones</span>
            <span>${data.observacion}</span>
          </div>
        </div>
        
        <div style="margin-top: 25px; text-align: center;">
          <button class="btn" onclick="resetInterface()">
            <i class="fas fa-redo"></i> Identificar otra planta
          </button>
        </div>
      `;
    }
    
    // Reiniciar interfaz
    function resetInterface() {
      fileInput.value = '';
      previewContainer.style.display = 'none';
      cameraContainer.style.display = 'none';
      permissionHelp.style.display = 'none';
      
      // Detener c√°mara si est√° activa
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
      
      // Restablecer secci√≥n de resultados
      plantInfo.style.display = 'none';
      plantInfo.innerHTML = '';
      resultPlaceholder.style.display = 'block';
    }
    
    // Inicializar cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>