<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Identificador de Plantas 🌿</title>
</head>
<body>
  <h1>📷 Identificador de Plantas</h1>
  <input type="file" id="fileInput" accept="image/*" capture="environment">
  <br><br>
  <img id="preview" width="300">
  <div id="info"></div>

  <script>
    const input = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const info = document.getElementById('info');

    input.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      
      if (!file) return;

      preview.src = URL.createObjectURL(file);
      info.innerHTML = "<p>🔄 Analizando la planta...</p>";

      // Crear formData para enviar como multipart/form-data
      const formData = new FormData();
      formData.append("images", file);
      formData.append("organs", "leaf"); // puedes usar "flower", "fruit", etc.

      try {
        const response = await fetch("https://my-api.plantnet.org/v2/identify/all?api-key=2b10qQGbfwNVuPVsvb8mZKCLfe", {
          method: "POST",
          body: formData
        });

        const result = await response.json();

        if (result.results && result.results.length > 0) {
          const bestMatch = result.results[0];
          info.innerHTML = `
            <h2>${bestMatch.species.scientificNameWithoutAuthor}</h2>
            <p><strong>Nombre común:</strong> ${bestMatch.species.commonNames.join(", ") || "No disponible"}</p>
            <p><strong>Confianza:</strong> ${(bestMatch.score * 100).toFixed(2)}%</p>
            <a href="https://es.wikipedia.org/wiki/${bestMatch.species.scientificNameWithoutAuthor}" target="_blank">🌍 Más info en Wikipedia</a>
          `;
        } else {
          info.innerHTML = "<p>⚠️ No se pudo identificar la planta.</p>";
        }
      } catch (err) {
        info.innerHTML = "<p>❌ Error al conectar con la API.</p>";
        console.error(err);
      }
    });
  </script>
  
</body>
</html>
